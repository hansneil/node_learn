(function(rt){var templates=rt.templates,attrs=function(){return rt.attrs.apply(rt,arguments)},_=function(){return rt._.apply(rt,arguments)},img=function(){return rt.img.apply(rt,arguments)},imgURL=function(){return rt.imgURL.apply(rt,arguments)},gifURL=function(){return rt.gifURL.apply(rt,arguments)},imgSuffixIsRetinaDisplay=function(){return rt.imgSuffixIsRetinaDisplay.apply(rt,arguments)},imgSize=function(){return rt.imgSize.apply(rt,arguments)},avatar=function(){return rt.avatar.apply(rt,arguments)},isVerified=function(){return rt.isVerified.apply(rt,arguments)},url=function(){return rt.url.apply(rt,arguments)},mkurl=function(){return rt.mkurl.apply(rt,arguments)},GACampaignURL=function(){return rt.GACampaignURL.apply(rt,arguments)},format_text=function(){return rt.format_text.apply(rt,arguments)},escape=function(){return rt.escape.apply(rt,arguments)},__t=rt.templates,emerge=function(){return rt.renderSync.apply(rt,arguments)};__t["dialog_box/alert"]=function(locals){var buf=[];with(locals||{}){var interp;buf.push("<div"),buf.push(attrs({"class":"dialog-overlay alert"})),buf.push("></div><div"),buf.push(attrs({id:"dialog_alert","data-name":"alert","class":"dialog-box"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">"+escape((interp=locals.title||"提示")==null?"":interp)+"</div><div"),buf.push(attrs({"class":"box-inner"})),buf.push("><div"),buf.push(attrs({"class":"info-text"})),buf.push("><i"),buf.push(attrs({"class":"icon-"+(locals.type||"caution")+""})),buf.push("></i>");var __val__=locals.text;buf.push(null==__val__?"":__val__),buf.push("</div></div><div"),buf.push(attrs({"class":"box-bottom"})),buf.push("><div"),buf.push(attrs({"class":"buttons"})),buf.push(">"),locals.cancelButton&&(buf.push("<a"),buf.push(attrs({href:"#",onclick:"return false;","class":"cancel btn btn18"})),buf.push("><span"),buf.push(attrs({"class":"text"})),buf.push("> 取消</span></a>")),buf.push("<a"),buf.push(attrs({href:"#",onclick:"return false;","class":"action btn btn18 rbtn"})),buf.push("><span"),buf.push(attrs({"class":"text"})),buf.push("> "+escape((interp=locals.action||"确定")==null?"":interp)+"</span></a></div></div>"),locals.closeButton&&(buf.push("<div"),buf.push(attrs({"class":"close-btn"})),buf.push("><i></i></div>")),buf.push('</div><script>(function(){var a=document.id("dialog_alert"),b=a.getElements(".box-bottom .btn, .close-btn");b.addEvent("click",function(b){var c=!!this.hasClass("action");a.fireEvent("confirm",c),app.hideDialogBox("alert"),b.stop()})})()</script>')}return buf.join("")},__t["dialog_box/chrome_addon"]=function(locals){var buf=[];with(locals||{}){var interp;buf.push("<div"),buf.push(attrs({"class":"dialog-overlay"})),buf.push("></div><div"),buf.push(attrs({id:"chrome_addon_download_tip",style:"width: 720px; margin-left: -360px;","class":"dialog-box"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">安装花瓣扩展小窍门</div><div"),buf.push(attrs({"class":"box-inner clearfix"})),buf.push("><div"),buf.push(attrs({"class":"step step1"})),buf.push("><div"),buf.push(attrs({"class":"title"})),buf.push(">下载完成，打开下载文件夹</div><img"),buf.push(attrs({src:"/img/chrome_notice_step_1.png"})),buf.push("/></div><div"),buf.push(attrs({"class":"step step2"})),buf.push("><div"),buf.push(attrs({"class":"title"})),buf.push(">打开浏览器扩展程序页面</div><img"),buf.push(attrs({src:"/img/chrome_notice_step_2.png"})),buf.push("/></div><div"),buf.push(attrs({"class":"step step3"})),buf.push("><div"),buf.push(attrs({style:"width: 157px","class":"title"})),buf.push(">把文件拖动到管理页面</div><img"),buf.push(attrs({src:"/img/chrome_notice_step_3.png"})),buf.push("/></div></div><div"),buf.push(attrs({"class":"close-btn"})),buf.push("><i></i></div></div>")}return buf.join("")},__t["dialog_box/create_board"]=function(locals){var buf=[];with(locals||{}){var interp,designer=locals.req&&locals.req.user&&locals.req.user.status&&locals.req.user.status.designer;!designer&&is_designer&&(designer=!0),buf.push("<div"),buf.push(attrs({"class":"dialog-overlay"})),buf.push("></div><div"),buf.push(attrs({id:"CreateBoard",style:"z-index: 99999","class":"dialog-box "+(typeof className=="undefined"?"":" "+className)})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">创建画板</div><div"),buf.push(attrs({"class":"box-inner"})),buf.push("><form"),buf.push(attrs({action:"","class":"Form StaticForm nm"})),buf.push("><ul><li"),buf.push(attrs({"class":"nbt"})),buf.push("><input"),buf.push(attrs({id:"id_board_title",type:"text",name:"title",value:"","class":"clear-input"})),buf.push("/><label>画板标题</label><span"),buf.push(attrs({"class":"fff"})),buf.push("></span></li><li><input"),buf.push(attrs({id:"id_category",type:"hidden",name:"category",value:""})),buf.push("/>");var __val__=emerge("base/category_picker");buf.push(null==__val__?"":__val__),buf.push("<label>画板分类</label></li></ul><div"),buf.push(attrs({"class":"Submit"})),buf.push("><a"),buf.push(attrs({href:"#",onclick:"return false;","class":"btn btn18 wbtn"})),buf.push("><strong>创建画板</strong><span></span></a></div></form></div><div"),buf.push(attrs({"class":"close-btn"})),buf.push('><i></i></div></div><script>(function(){var a=$("CreateBoard");if(a.retrieve("initialized"))return;var b=$("id_board_title"),c=a.getElement(".CategoryPicker"),d=new CategoryPicker(c);new Button(a.getElement(".Submit a"),{click:function(){var a=b.get("value").trim();if(a=="")return app.showTip(b,"请输入名称",{width:150});var c=d.getSelected();return c?(this.disable(),(new Request.JSON({url:"/boards/",data:{title:a,category:c,creation:undefined},onSuccess:function(a){a.err?app.error(a.msg):app.page.$userTask&&app.page.$userTask.isShowing?(app.hideDialog(),app.page.$userTask.resetOverlay(),app.page.$userTask.showModule("step1-5")):window.location="/boards/"+a.board.board_id+"/"},onFailure:function(){app.error(app.COMMON_ERRMSG)},onComplete:function(){this.enable()}.bind(this)})).post(),!1):app.showTip(d.element,"请选择分类",{width:150})}}),d.addEvent("select",function(){app.hideTip(d.element)}),a.getElements("input").addEvent("blur",function(a){app.hideTip(a.target)}),a.store("initialized",!0)})(),function(){var a=document.id("CreateBoard");a&&a.getElement(".Form").addEvent("submit",function(){return a.getElement(".Submit .btn").click(),!1})}()</script>')}return buf.join("")},__t["dialog_box/create_pin"]=function(locals){var buf=[];with(locals||{}){var interp;buf.push("<div"),buf.push(attrs({"class":"dialog-overlay"})),buf.push("></div><div"),buf.push(attrs({id:"create_pin","data-name":"upload","class":"dialog-box"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">"+escape((interp=locals.title||"新采集")==null?"":interp)+"</div><div"),buf.push(attrs({"class":"box-inner"})),buf.push(">");var __val__=emerge("base/pin_create",locals);buf.push(null==__val__?"":__val__),buf.push("</div><div"),buf.push(attrs({"class":"close-btn"})),buf.push('><i></i></div><script>(function(){var a=document.id("create_pin"),b=a.getElement(".text-block .description"),c=a.getElement(".board-list"),d=a.getElement(".action"),e=a.getElement(".cancel"),f=a.getElements(".shares .share"),g=a.getElement(".board-list");d.addEvent("click",function(){var a=c.get("data-board-id");if(!a)return app.alert("请选择或者创建一个画板");var d={board_id:a,text:b.value,check:!0,file_id:"'+escape((interp=file_id)==null?"":interp)+'",via:1},e=0;f.each(function(a){if(!a.hasClass("active"))return;var b=a.get("data-key"),c=a.get("data-flag");d[b]=!0,e|=c;try{ga("send","event","SocialShare",b+":{api}","PinDialog:"+app.page.pin.source)}catch(f){}}),app.req.user.status.share=d.share_button=e,g.fireEvent("submit");var h=(new Request.JSON({url:"/pins/",data:d,onSuccess:function(a){if(a.err){app.alert(a.msg||app.COMMON_ERRMSG),app.feedback(Object.merge(d,a));return}if(a.warning==100){app.confirm(\'你已经在画板<a target="_blank" href="/boards/\'+a.pin.board.board_id+\'/"><em>\'+a.pin.board.title+"</em></a>中采集过这张图片，是否继续？",function(a){if(!a)return;delete h.options.data.check,h.post()});return}app.hideDialogBox("create_pin"),app.$pin=a.pin,app.showDialogBox("pin_success",!0)},onFailure:function(a){app.feedback(Object.merge(d,{err:a.status}))}})).post()}),e.addEvent("click",function(){app.hideDialogBox("create_pin"),app.showDialogBox("upload",!0)})})()</script></div>')}return buf.join("")},__t["dialog_box/dm"]=function(locals){var buf=[];with(locals||{}){var interp;buf.push("<div"),buf.push(attrs({id:"dm_box"})),buf.push("><div"),buf.push(attrs({"class":"dialog-overlay"})),buf.push("></div><div"),buf.push(attrs({"class":"dialog-box list-view"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">私信<div"),buf.push(attrs({"class":"close-btn"})),buf.push("><i></i></div></div><div"),buf.push(attrs({"class":"box-inner"})),buf.push("><div"),buf.push(attrs({"class":"conversation-list"})),buf.push("></div><div"),buf.push(attrs({"class":"bottom"})),buf.push("></div><div"),buf.push(attrs({"class":"empty hidden"})),buf.push("><h2>现在你可以发送私信啦！</h2><div"),buf.push(attrs({"class":"sub"})),buf.push(">要发送私信，请到该用户主页，点击私信按钮</div><img"),buf.push(attrs({src:"/img/send_msg_intr.jpg"})),buf.push("/></div></div></div><div"),buf.push(attrs({style:"display:none","class":"dialog-box dialog-view"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push("><a"),buf.push(attrs({"class":"brown-link back"})),buf.push(">私信</a><span"),buf.push(attrs({"class":"dialog-only-text"})),buf.push(">私信给</span><span"),buf.push(attrs({"class":"symbol"})),buf.push(">»</span><span"),buf.push(attrs({"class":"with-user-name"})),buf.push(">呵呵</span><div"),buf.push(attrs({"class":"action"})),buf.push("><div"),buf.push(attrs({"class":"open"})),buf.push("></div><ul><li"),buf.push(attrs({"class":"block"})),buf.push(">屏蔽此人</li></ul></div><div"),buf.push(attrs({"class":"close-btn"})),buf.push("><i></i></div></div><div"),buf.push(attrs({"class":"box-inner"})),buf.push("><div"),buf.push(attrs({"class":"messages"})),buf.push("></div><div"),buf.push(attrs({"class":"send-box clearfix"})),buf.push("><textarea"),buf.push(attrs({"class":"clear-input"})),buf.push("></textarea><a"),buf.push(attrs({href:"#",onclick:"return false;","class":"send disabled btn"})),buf.push("><span"),buf.push(attrs({"class":"text"})),buf.push('> 发送私信</span></a></div></div></div></div><script>(function(){var a=new Class({options:{interval:3e4,listLimit:20},initialize:function(a){this.nowOnDialog=null;var b=this,a=this.mainEl=$(a);this.listView=a.getElement(".dialog-box.list-view"),this.listEl=this.listView.getElement(".conversation-list"),this.dialogView=a.getElement(".dialog-box.dialog-view"),this.dialogEl=this.dialogView.getElement(".messages"),this.indicator=document.getElements("#nav_user .dm-nav .num"),this.listLoadingEl=new Element("div.loding-more"),[this.dialogEl,this.listEl].each(function(a){stopWindowScroll(a);var b=a.getParent(".box-inner");a.addEvent("scroll",function(a){this.getScroll().y!=0?b.addClass("scrolled"):b.removeClass("scrolled")})}),a.addEvent("click:relay(.dialog-overlay, .close-btn)",function(a){b.hide(),a.stop()}),a.addEvent("click:relay(.action .open)",function(a){b.mainEl.getElements(".action").removeClass("active"),this.getParent(".action").addClass("active")}),a.addEvent("click:relay(.conversation-list .conversation)",function(a){if(a.target.getParent(".action")||a.target.getParent(".avt"))return;b.showDialog({username:this.get("data-with-user-name"),user_id:this.get("data-with-user-id")}),this.hasClass("unread")&&(this.removeClass("unread"),b.decreaseIndicator())}),a.addEvent("click",function(a){if(a.target.match(".action .open"))return;b.mainEl.getElements(".action").removeClass("active")}),this.dialogView.getElement(".box-title .back").addEvent("click",function(){if(b.nowOnDialog&&b.nowOnDialog.modified){var a=b.nowOnDialog.user_id;return b.reposition(a)}b.showList()}),a.addEvent("click:relay(.action .block)",function(){var a=this.getParent(".conversation"),c=null;if(a)c=a.get("data-with-user-id");else{if(!b.nowOnDialog)return;c=b.nowOnDialog.user_id}app.confirm("确定屏蔽此人？屏蔽后对方无法再向你发送私信。你可以在帐号设置页面中解除对他的屏蔽。",function(d){if(!d)return;(new Request.JSON({url:"/dm/block/",data:{user_id:c},onSuccess:function(d){if(d.err)return app.error(app.COMMON_ERRMSG);a?a.fade("out").get("tween").chain(function(){a.dispose()}):b.nowOnDialog&&(b.removeConversation(c),b.showList())},onFailure:function(){app.error(app.COMMON_ERRMSG)}})).post()})}),a.addEvent("click:relay(.report)",function(){return window.report_type="dm",window.report_id=this.getParent(".message").get("data-dm-id"),app.showDialog("report"),!1});var c=a.getElement(".send-box"),d=this.textarea=c.getElement("textarea"),e=this.sendButton=c.getElement(".send");d.addEvents({keyup:function(){this.value.clean()?e.removeClass("disabled"):e.addClass("disabled")},keydown:function(a){if(a.key=="enter"&&(a.control||a.meta))return e.fireEvent("click"),!1}}),e.addEvent("click",function(){if(!d.value.clean())return;var a=d.value;d.value="",b.insertConversation({text:a,created_at:new Date/1e3}),b.dialogEl.scrollTo(0,b.dialogEl.scrollHeight),d.focus();var c=b.nowOnDialog.user_id;(new Request.JSON({url:"/dm/send/",data:{to_user_id:c,text:a},onSuccess:function(a){if(a.err)return app.error(a.msg||app.COMMON_ERRMSG);b.updateConversation(c,a)},onFailure:function(){app.error(app.COMMON_ERRMSG)}})).post(),b.nowOnDialog.modified=!0}),this.listEl.addEvent("scroll",function(a){this.getSize().y+this.getScroll().y>=this.scrollHeight&&b.loadList()}),Asset.image("/img/msg_loading.gif"),this.updateIndicator(app.req.unread_dm||0)},openFreshList:function(){this.showList(),this.refreshList(),this.fetch()},show:function(){this.isShowing=!0,this.mainEl.show()},hide:function(){this.isShowing=!1,this.mainEl.hide()},showList:function(){this.show(),this.listView.show(),this.dialogView.hide()},showDialog:function(a,b){this.show(),this.listView.hide(),this.nowOnDialog=a,this.dialogView.getElement(".with-user-name").innerHTML=a.username,this.dialogView.show(),this.refreshDialog(),a.user_id=="system"?this.dialogView.addClass("system-dm"):(this.dialogView.removeClass("system-dm"),this.textarea.focus()),b?this.mainEl.addClass("dialog-only"):this.mainEl.removeClass("dialog-only")},showEmptyList:function(){this.listEl.getNext(".empty").clone().inject(this.listEl).removeClass("hidden")},refreshList:function(){var a=this;this.listEl.empty(),this.showLoading(this.listEl,300),(new Request.JSON({url:"/dm/",data:{limit:a.options.listLimit},noCache:!0,onSuccess:function(b){a.hideLoading(a.listEl),b.conversations&&b.conversations.length?(b.conversations.each(function(b){var c=app.renderSync("base/dm_list_item",b),d=Elements.from(c).inject(a.listEl)}),b.conversations.length<a.options.listLimit&&a.listNoMore()):a.showEmptyList()}})).get()},loadList:function(a){if(this.listloading||this.listReachTheBottom)return;var b=this,a=this.listEl.getLast(".conversation").get("data-updated-at");this.showListLoadingMore(),this.listloading=!0,(new Request.JSON({url:"/dm/",data:{max:a,limit:b.options.listLimit},noCache:!0,onSuccess:function(a){b.hideListLoadingMore(),b.listloading=!1,a.conversations&&a.conversations.length&&a.conversations.each(function(a){var c=app.renderSync("base/dm_list_item",a),d=Elements.from(c).inject(b.listEl)}),(!a.conversations||a.conversations.length<b.options.listLimit)&&b.listNoMore()}})).get()},showListLoadingMore:function(){this.listLoadingEl.inject(this.listEl)},hideListLoadingMore:function(){this.listLoadingEl.dispose()},listNoMore:function(){this.listReachTheBottom=!0},refreshDialog:function(){var a=this.dialogEl,b=this.textarea,c=this.sendButton,d=this,e="/dm/messages/"+this.nowOnDialog.user_id+"/";a.empty(),this.showLoading(a,300),b.value="",c.addClass("disabled"),this.nowOnDialog.user_id=="system"&&(e="/system_dm/"),(new Request.JSON({url:e,noCache:!0,onSuccess:function(c){d.hideLoading(a);var e=d.insertConversations(c.messages||[]);c.blocked=="with_user blocked user"?((new Element("div.error-alert",{html:"<i></i>你已被对方屏蔽，不能发送私信"})).inject(a),b.set("disabled","disabled")):c.blocked=="user blocked with_user"?((new Element("div.error-alert",{html:\'<i></i>你已屏蔽此用户，可以在<a href="/settings/#set_blocked_conversations">帐号设置</a>中解除对他的屏蔽\'})).inject(a),b.set("disabled","disabled")):c.blocked=="user is banned"?((new Element("div.error-alert",{html:"<i></i>你的帐号已被禁止"})).inject(a),b.set("disabled","disabled")):c.blocked=="with_user is banned"?((new Element("div.error-alert",{html:"<i></i>此用户已被禁止"})).inject(a),b.set("disabled","disabled")):b.erase("disabled");var f=new Fx.Scroll(d.dialogEl,{duration:0,offset:{x:0,y:-10}});e?f.toElement(e):a.scrollTo(0,a.scrollHeight)}})).get()},showLoading:function(a,b){b||(b=0),this.loadingTimer=setTimeout(function(){a.addClass("dm-loading")},b)},hideLoading:function(a){this.loadingTimer&&clearTimeout(this.loadingTimer),a.removeClass("dm-loading")},fetch:function(){if(this.fetching)return;this.fetching=!0,(new Request.JSON({url:"/dm/unread/",noCache:!0,onSuccess:function(a){if(a.err)return;this.updateIndicator(a)}.bind(this),onComplete:function(){this.fetching=!1}.bind(this)})).get()},updateIndicator:function(a){this.indicator.set("text",a),a<=0?this.indicator.addClass("hidden"):this.indicator.removeClass("hidden")},decreaseIndicator:function(a){this.updateIndicator(--app.req.unread_dm)},updateConversation:function(a,b){var c=this.listEl.getElement(\'[data-with-user-id="\'+a+\'"]\');c.getElement(".content").set("text",b.text),c.getElement(".time").set({"data-ts":b.created_at,text:(new Date(b.created_at.toInt()*1e3)).timeAgo()})},removeConversation:function(a){return this.listEl.getElement(\'[data-with-user-id="\'+a+\'"]\').dispose()},reposition:function(a){var b=this.removeConversation(a);b.inject(this.listEl,"top"),this.showList()},_isShowTS:function(a,b){return b?a-b>=1800:!0},insertConversation:function(a){var b=this.dialogEl.getLast(".message"),c=app.renderSync("base/dm_dialog_item",{from_user:app.req.user,type:"sent",text:a.text,created_at:a.created_at,showTS:this._isShowTS(a.created_at,b&&b.get("data-ts"))});Elements.from(c).inject(this.dialogEl)},insertConversations:function(a){var b;for(var c=0;c<a.length;c++){if(!a[c])continue;var d=app.renderSync("base/dm_dialog_item",Object.merge(a[c],{showTS:this._isShowTS(a[c].created_at,a[c-1]&&a[c-1].created_at)}));b=Elements.from(d)[0].inject(this.dialogEl)}return b}});app.req.user&&(app.page.dmController=new a("dm_box"))})()</script>')}return buf.join("")},__t["dialog_box/move_pins"]=function(locals){var buf=[];with(locals||{}){var interp;buf.push("<div"),buf.push(attrs({"class":"dialog-overlay"})),buf.push("></div><div"),buf.push(attrs({"data-name":"move_pins",style:"width: 440px; margin-left: -220px;","class":"dialog-box"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">移动至...</div><div"),buf.push(attrs({"class":"box-inner"})),buf.push(">");var __val__=emerge("base/board_list",{creationOnly:is_creation});buf.push(null==__val__?"":__val__),buf.push("<a"),buf.push(attrs({style:"margin-top: 20px",href:"#",onclick:"return false;","class":"go btn btn18 rbtn"})),buf.push("><span"),buf.push(attrs({"class":"text"})),buf.push("> 批量移动</span></a></div><div"),buf.push(attrs({"class":"close-btn"})),buf.push("><i></i></div></div>")}return buf.join("")},__t["dialog_box/pin_success"]=function(locals){var buf=[];with(locals||{}){var interp;buf.push("<div"),buf.push(attrs({"class":"dialog-overlay"})),buf.push("></div><div"),buf.push(attrs({id:"pin_success","class":"dialog-box"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">采集成功</div><div"),buf.push(attrs({"class":"box-inner"})),buf.push(">");var __val__=emerge("base/pin_success");buf.push(null==__val__?"":__val__),buf.push("</div><div"),buf.push(attrs({"class":"close-btn"})),buf.push("><i></i></div></div>")}return buf.join("")},__t["dialog_box/repin"]=function(locals){var buf=[];with(locals||{}){var interp;buf.push("<div"),buf.push(attrs({"class":"dialog-overlay"})),buf.push("></div><div"),buf.push(attrs({id:"repin_dialog","data-name":"repin","class":"dialog-box"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">转采</div><div"),buf.push(attrs({style:"display: none","class":"box-warning"})),buf.push("></div><div"),buf.push(attrs({"class":"box-inner"})),buf.push(">");var __val__=emerge("base/pin_create");buf.push(null==__val__?"":__val__),buf.push("</div><div"),buf.push(attrs({"class":"close-btn"})),buf.push('><i></i></div><script>(function(){var a=document.id("repin_dialog"),b=a.getElement(".text-block .description"),c=a.getElement(".board-list"),d=a.getElement(".action"),e=a.getElements(".shares .share"),f="'+escape((interp=locals.pin_id)==null?"":interp)+'",g=a.getElement(".box-warning"),h=a.getElement(".preview img"),i=a.getElement(".board-list");a.addEvent("click:relay(.box-warning .cancel)",function(){app.hideDialogBox("repin")}),(new Request.JSON({url:"/pins/"+f+"/repin/?check=true",onSuccess:function(a){if(a.err){app.hideDialogBox("repin"),app.error(a.msg||app.COMMON_ERRMSG);return}a.warning&&a.warning==100&&(g.show().innerHTML=\'这张图片已经在你的<a href="/boards/{board_id}/">{board_title}</a>画板里了，你可以<a class="cancel">取消</a>本次采集\'.replace("{board_id}",a.exist_pin.board.board_id).replace("{board_title}",a.exist_pin.board.title)),h.src=app.imgURL(a.pin.file,"fw236"),b.value=a.pin.raw_text,d.removeClass("disabled")}})).get(),d.addClass("disabled"),d.addEvent("click",function(){if(this.hasClass("disabled"))return;var a=c.get("data-board-id");if(!a)return app.alert("请选择或者创建一个画板");var g={board_id:a,text:b.value,via:f},h=0;e.each(function(a){if(!a.hasClass("active"))return;var b=a.get("data-key"),c=a.get("data-flag");g[b]=!0,h|=c;try{ga("send","event","SocialShare",b+":{api}","PinDialog:"+app.page.pin.source)}catch(d){}}),app.req.user.status.share=g.share_button=h,d.addClass("disabled"),i.fireEvent("submit");var j=(new Request.JSON({url:"/pins/",data:g,onSuccess:function(a){if(a.err){app.alert(a.msg||app.COMMON_ERRMSG),app.feedback(Object.merge(g,a));return}app.hideDialogBox("repin"),app.$pin=a.pin,app.showDialogBox("pin_success",!0)},onFailure:function(a){app.feedback(Object.merge(g,{err:a.status}))},onComplete:function(){d.removeClass("disabled")}})).post()})})()</script></div>')}return buf.join("")},__t["dialog_box/upload"]=function(locals){var buf=[];with(locals||{}){var interp;buf.push("<div"),buf.push(attrs({"class":"dialog-overlay"})),buf.push("></div><div"),buf.push(attrs({id:"image_upload","data-name":"upload","class":"dialog-box"})),buf.push("><div"),buf.push(attrs({"class":"box-title"})),buf.push(">上传采集</div><div"),buf.push(attrs({"class":"box-inner"})),buf.push("><div"),buf.push(attrs({"class":"upload-area"})),buf.push("><div"),buf.push(attrs({"class":"normal"})),buf.push("><a"),buf.push(attrs({href:"#",onclick:"return false;","class":"upload-btn btn btn18"})),buf.push("><span"),buf.push(attrs({"class":"text"})),buf.push("> 上传采集</span></a><div"),buf.push(attrs({style:"margin-top: 25px","class":"note"})),buf.push(">也可以拖拽图片到该区域，完成上传</div><div"),buf.push(attrs({style:"margin: 10px 0 25px","class":"sub"})),buf.push(">支持单张 10m 以内图片上传</div><div"),buf.push(attrs({style:"margin-top: 20px; font-size: 12px","class":"sub"})),buf.push(">[提示]请严格遵守保密法律法规，严禁在互联网上存储、处理、传输、发布涉密信息</div></div><div"),buf.push(attrs({style:"display: none","class":"draging"})),buf.push("><div"),buf.push(attrs({"class":"note"})),buf.push(">释放鼠标以上传</div></div><div"),buf.push(attrs({style:"display: none","class":"uploading"})),buf.push("><div"),buf.push(attrs({"class":"animate"})),buf.push(">上传中...</div></div><div"),buf.push(attrs({"class":"dropzone"})),buf.push("></div></div><div"),buf.push(attrs({"class":"links"})),buf.push("><div"),buf.push(attrs({"class":"part"})),buf.push("><a"),buf.push(attrs({target:"_blank",href:"/about/goodies","class":"brown-link"})),buf.push(">安装采集工具</a><div"),buf.push(attrs({"class":"description"})),buf.push(">一键采集互联网上的任意图片</div></div><div"),buf.push(attrs({"class":"part"})),buf.push("><a"),buf.push(attrs({href:"/all/","class":"brown-link"})),buf.push(">在站内逛逛</a><div"),buf.push(attrs({"class":"description"})),buf.push(">点击采集按钮，一键转采喜欢的图片</div></div></div></div><div"),buf.push(attrs({"class":"close-btn"})),buf.push('><i></i></div></div><script>(function(){var a=document.id("image_upload"),b=a.getElement(".upload-btn"),c=a.getElement(".upload-area"),d=c.getElement(".normal"),e=d.getElement(".note"),f=c.getElement(".uploading"),g=c.getElement(".draging"),h=a.getElement(".close-btn"),i=a.getElement("!~"),j=a.getElement(".dropzone"),k=!1,l=function(a){var b=app.imgURL(a,"fw192");app.hideDialogBox("upload");var c={media:b,w:a.width,h:a.height,file_id:a.id,description:"",url:"",title:"上传采集",req:app.req,name:a.name,cancel:!0};app.req.user&&app.page.board&&app.req.user.user_id===app.page.board.user_id&&(c.current_board=app.page.board),app.showDialogBox("create_pin",c)},m=function(a){a.stop();if(f.getStyle("display")=="none")return app.hideDialogBox("upload");app.confirm("正在上传采集，要停止上传吗？",function(a){if(!a)return;k=!0,app.hideDialogBox("upload")})};i.addEvent("click",m),h.addEvent("click",m);if(Browser.ie&&Browser.version<10){e.hide();var n={start:function(){d.hide(),f.show(),k=!1},failed:function(a){d.show(),f.hide(),app.error("上传出错: "+(a.msg||app.COMMON_ERRMSG))},complete:function(a){if(k)return;l(a)}};(new Uploadr(b)).addEvents(n),j.hide()}else{var o=function(){var a=new Dropzone(j,{url:"/upload/",maxFilesize:10,maxFiles:1,acceptedFiles:"image/*"});a.on("dragenter",function(){d.hide(),g.show(),c.addClass("active")}),a.on("dragover",function(){d.hide(),g.show(),c.addClass("active")}),a.on("dragleave",function(){d.show(),g.hide(),c.removeClass("active")}),a.on("dragend",function(){d.show(),g.hide(),c.removeClass("active")}),a.on("sending",function(){d.hide(),f.show(),g.hide(),c.removeClass("active"),k=!1}),a.on("canceled",function(){d.show(),f.hide()}),a.on("error",function(a,b){d.show(),g.hide(),c.removeClass("active"),f.hide(),app.error(b)}),a.on("success",function(a,b){if(k)return;if(b.err)d.show(),f.hide(),app.error("上传出错: "+(b.msg||app.COMMON_ERRMSG));else{var c=["jpg","png","jpeg","gif","JPG","PNG","JPEG","GIF"],e=a.name.split(".");b.name=(e.length>1&&c.indexOf(e[e.length-1])!==-1?e.pop():e)&&e.join("."),l(b)}})};Asset.javascript("/js/lib/dropzone.js",{onLoad:o})}})()</script>')}return buf.join("")}})(app);